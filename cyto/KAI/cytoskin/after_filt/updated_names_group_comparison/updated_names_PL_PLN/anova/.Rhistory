tmp2$Sample <- unname(tmp2$Sample)
tmp2$Age_of_disease_onset <- unname(tmp2$Age_of_disease_onset)
tmp2$Psoriasis_in_family <- unname(tmp2$Psoriasis_in_family)
tmp2 <- tmp2[,c(4,5,6)]
outDf <- ddply(tmp2, "variable", function(tmp2)  myAov(tmp2))
colnames(outDf)[5] <- "p_adj"
colnames(outDf)[2] <- "Difference"
colnames(outDf)[6] <- "Groups"
View(outDf)
PS_EarlyFam_vs_LateNoFam=outDf[outDf%in%c("PL.typeII-PL.typeI","PNL.typeII-PNL.typeI"),]
PS_typeI_typeII_PL_PN=outDf[outDf%in%c("PL.typeII-PL.typeI","PNL.typeII-PNL.typeI"),]
PS_typeI_typeII_PL_PN_signif=PS_typeI_typeII_PL_PN[PS_typeI_typeII_PL_PN$p_adj<0.05,]
save(PS_typeI_typeII_PL_PN,PS_typeI_typeII_PL_PN_signif, file = "PS_typeI_typeII_PL_PN_anova.RData")
write.table(PS_typeI_typeII_PL_PN_signif, file="PS_typeI_typeII_PL_PNL.txt", sep="\t", quote=F)
PS_typeI_typeII_PL_PN_signif
PS_typeI_typeII_PL_PN
View(outDf)
PS_typeI_typeII_PL_PN=outDf[outDf%in%c("PL.typeII-PL.typeI","PNL.typeII-PNL.typeI"),]
PS_typeI_typeII_PL_PN=outDf[outDf$Groups%in%c("PL.typeII-PL.typeI","PNL.typeII-PNL.typeI"),]
PS_typeI_typeII_PL_PN_signif=PS_typeI_typeII_PL_PN[PS_typeI_typeII_PL_PN$p_adj<0.05,]
save(PS_typeI_typeII_PL_PN,PS_typeI_typeII_PL_PN_signif, file = "PS_typeI_typeII_PL_PN_anova.RData")
write.table(PS_typeI_typeII_PL_PN_signif, file="PS_typeI_typeII_PL_PNL.txt", sep="\t", quote=F)
PS_typeI_typeII_PL_PN_signif
gplot(PS_typeI_typeII_PL_PN, aes(x=Difference,y=Groups,color=p_adj))+
geom_point()+
theme_bw()+
facet_wrap(~variable)+
theme(axis.text.x = element_text(colour="black"), axis.text.y = element_text(size=9))+
geom_errorbarh(aes(xmax = upr, xmin = lwr, height = .2))
ggplot(PS_typeI_typeII_PL_PN, aes(x=Difference,y=Groups,color=p_adj))+
geom_point()+
theme_bw()+
facet_wrap(~variable)+
theme(axis.text.x = element_text(colour="black"), axis.text.y = element_text(size=9))+
geom_errorbarh(aes(xmax = upr, xmin = lwr, height = .2))
annotation.h=annotationh[rownames(annotationh)%in%colnames(p)[1:63],colnames(annotationh)%in%c("PASI_(activity_score)","Age_of_disease_onset")]
annotation.h=annotation.h[order(annotation.h[,2]),]
annotation.h[annotation.h[,2]>=40, 2]<-"late"
annotation.h[annotation.h[,2]< 40,2]<-"early"
annotation.t=annotationt[rownames(annotationt)%in%colnames(p)[1:63],colnames(annotationt)%in%c("Age_of_disease_onset", "PASI_(activity_score)")]
annotation.t=annotation.t[order(annotation.t[,2]),]
annotation.t[annotation.t[,2]>=40, 2]<-"late"
annotation.t[annotation.t[,2]<40, 2]<-"early"
annotation.h[,1]=str_replace(annotation.h[,1],",",".")
annotation.h=data.frame(annotation.h)
annotation.h[,1]=as.numeric(as.vector(annotation.h[,1]))
annotation.h[,1]=cut(annotation.h[,1], c(0, 10, 20, Inf))
annotation.h=annotation.h[order(annotation.h[,1]),]
annotation.t[,1]=str_replace(annotation.t[,1],",",".")
annotation.t=data.frame(annotation.t)
annotation.t[,1]=as.numeric(as.vector(annotation.t[,1]))
annotation.t[,1]=cut(annotation.t[,1], c(0, 10, 20, Inf))
annotation.t=annotation.t[order(annotation.t[,1]),]
annotation.pso.h.t=rbind(annotation.h, annotation.t)
Sample=rownames(annotation.pso.h.t)
Sample=str_replace(Sample,"0.*","")
annotation.pso.h.t=cbind(Sample,annotation.pso.h.t)
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"10,20","10_20")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"0,10","0_10")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"20,Inf","20_Inf")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\(","")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\]","")
colnames(annotation.pso.h.t)[2]="PASI"
annotation.pso.h.t=as.data.frame(annotation.pso.h.t)
annotation.pso.h.t[,1]=as.character(annotation.pso.h.t[,1])
annotation.pso.h.t[,2]=as.character(annotation.pso.h.t[,2])
annotation.pso.h.t[,3]=as.character(annotation.pso.h.t[,3])
annotation.pso.h.t=cbind(annotation.pso.h.t, interaction(annotation.pso.h.t$Age_of_disease_onset, annotation.pso.h.t$PASI))
colnames(annotation.pso.h.t)[4]="interactions"
ann=cbind(annotation.pso.h.t, rownames(annotation.pso.h.t))
keep=c("early.20_Inf","late.0_10")
ann_filt=ann[ann$interactions%in%keep,]
ann=ann_filt
colnames(ann)[5]="sample"
dt.merged=merge(ann,dt,by="sample",all=T)
dt.merged.melt=melt(dt.merged)
colnames(dt.merged.melt)[7]="Expression"
tmp <- subset(dt.merged.melt,variable%in%selected_genes_log_all)
tmp=tmp[tmp$interactions%in%keep,]
#plot groups
colnames(tmp)[6]="Gene"
ggplot(tmp, aes(x=Gene,y=Expression,color=interactions))+
geom_jitter(aes(shape = interactions),position = position_jitter(width = .21),size = 2.5)+
theme_bw()
#Aov example for many genes
myAov <- function(df){
aov_list <- aov(Expression~interactions, data=df)
aov_out <- as.data.frame(TukeyHSD(aov_list, "interactions")$interactions)
aov_out$groups <- rownames(aov_out)
return(aov_out)
}
tmp2 <- tmp[,-c(1)]
tmp2$Sample <- unname(tmp2$Sample)
tmp2$Age_of_disease_onset <- unname(tmp2$Age_of_disease_onset)
tmp2$PASI <- unname(tmp2$PASI)
tmp2 <- tmp2[,c(4,5,6)]
outDf <- ddply(tmp2, "Gene", function(tmp2)  myAov(tmp2))
colnames(outDf)[5] <- "p_adj"
colnames(outDf)[2] <- "Difference"
colnames(outDf)[6] <- "Groups"
View(outDf)
annotation.h=annotationh[rownames(annotationh)%in%colnames(p)[1:63],colnames(annotationh)%in%c("PASI_(activity_score)","Age_of_disease_onset")]
annotation.h=annotation.h[order(annotation.h[,2]),]
annotation.h[annotation.h[,2]>=40, 2]<-"late"
annotation.h[annotation.h[,2]< 40,2]<-"early"
annotation.t=annotationt[rownames(annotationt)%in%colnames(p)[1:63],colnames(annotationt)%in%c("Age_of_disease_onset", "PASI_(activity_score)")]
annotation.t=annotation.t[order(annotation.t[,2]),]
annotation.t[annotation.t[,2]>=40, 2]<-"late"
annotation.t[annotation.t[,2]<40, 2]<-"early"
annotation.h[,1]=str_replace(annotation.h[,1],",",".")
annotation.h=data.frame(annotation.h)
annotation.h[,1]=as.numeric(as.vector(annotation.h[,1]))
annotation.h[,1]=cut(annotation.h[,1], c(0, 10, 20, Inf))
annotation.h=annotation.h[order(annotation.h[,1]),]
annotation.t[,1]=str_replace(annotation.t[,1],",",".")
annotation.t=data.frame(annotation.t)
annotation.t[,1]=as.numeric(as.vector(annotation.t[,1]))
annotation.t[,1]=cut(annotation.t[,1], c(0, 10, 20, Inf))
annotation.t=annotation.t[order(annotation.t[,1]),]
annotation.pso.h.t=rbind(annotation.h, annotation.t)
Sample=rownames(annotation.pso.h.t)
Sample=str_replace(Sample,"0.*","")
annotation.pso.h.t=cbind(Sample,annotation.pso.h.t)
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"10,20","10_20")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"0,10","0_10")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"20,Inf","20_Inf")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\(","")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\]","")
colnames(annotation.pso.h.t)[2]="PASI"
annotation.pso.h.t=as.data.frame(annotation.pso.h.t)
annotation.pso.h.t[,1]=as.character(annotation.pso.h.t[,1])
annotation.pso.h.t[,2]=as.character(annotation.pso.h.t[,2])
annotation.pso.h.t[,3]=as.character(annotation.pso.h.t[,3])
annotation.pso.h.t=cbind(annotation.pso.h.t, interaction(annotation.pso.h.t$Sample, annotation.pso.h.t$Age_of_disease_onset, annotation.pso.h.t$PASI))
colnames(annotation.pso.h.t)[4]="interactions"
ann=cbind(annotation.pso.h.t, rownames(annotation.pso.h.t))
colnames(ann)[5]="sample"
keep=c("PSL.early.20_Inf","PSNL.early.20_Inf","PSL.late.20_Inf","PSNL.late.20_Inf")
ann_filt=ann[ann$interactions%in%keep,]
ann=ann_filt
annotation.h=annotationh[rownames(annotationh)%in%colnames(p)[1:63],colnames(annotationh)%in%c("PASI_(activity_score)","Age_of_disease_onset")]
annotation.h=annotation.h[order(annotation.h[,2]),]
annotation.h[annotation.h[,2]>=40, 2]<-"late"
annotation.h[annotation.h[,2]< 40,2]<-"early"
annotation.t=annotationt[rownames(annotationt)%in%colnames(p)[1:63],colnames(annotationt)%in%c("Age_of_disease_onset", "PASI_(activity_score)")]
annotation.t=annotation.t[order(annotation.t[,2]),]
annotation.t[annotation.t[,2]>=40, 2]<-"late"
annotation.t[annotation.t[,2]<40, 2]<-"early"
annotation.h[,1]=str_replace(annotation.h[,1],",",".")
annotation.h=data.frame(annotation.h)
annotation.h[,1]=as.numeric(as.vector(annotation.h[,1]))
annotation.h[,1]=cut(annotation.h[,1], c(0, 10, 20, Inf))
annotation.h=annotation.h[order(annotation.h[,1]),]
annotation.t[,1]=str_replace(annotation.t[,1],",",".")
annotation.t=data.frame(annotation.t)
annotation.t[,1]=as.numeric(as.vector(annotation.t[,1]))
annotation.t[,1]=cut(annotation.t[,1], c(0, 10, 20, Inf))
annotation.t=annotation.t[order(annotation.t[,1]),]
annotation.pso.h.t=rbind(annotation.h, annotation.t)
Sample=rownames(annotation.pso.h.t)
Sample=str_replace(Sample,"0.*","")
annotation.pso.h.t=cbind(Sample,annotation.pso.h.t)
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"10,20","10_20")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"0,10","0_10")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"20,Inf","20_Inf")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\(","")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\]","")
colnames(annotation.pso.h.t)[2]="PASI"
annotation.pso.h.t=as.data.frame(annotation.pso.h.t)
annotation.pso.h.t[,1]=as.character(annotation.pso.h.t[,1])
annotation.pso.h.t[,2]=as.character(annotation.pso.h.t[,2])
annotation.pso.h.t[,3]=as.character(annotation.pso.h.t[,3])
annotation.pso.h.t=cbind(annotation.pso.h.t, interaction(annotation.pso.h.t$Sample, annotation.pso.h.t$Age_of_disease_onset, annotation.pso.h.t$PASI))
colnames(annotation.pso.h.t)[4]="interactions"
ann=cbind(annotation.pso.h.t, rownames(annotation.pso.h.t))
colnames(ann)[5]="sample"
keep=c("PL.early.20_Inf","PNL.early.20_Inf","PL.late.20_Inf","PNL.late.20_Inf")
ann_filt=ann[ann$interactions%in%keep,]
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
ann=ann_filt
#Merge annotation with the data andsubset differentially expressed genes
dt.merged=merge(ann,dt,by="sample",all=T)
dt.merged.melt=melt(dt.merged)
colnames(dt.merged.melt)[7]="Expression"
tmp <- subset(dt.merged.melt,variable%in%selected_genes_log_all)
tmp=tmp[tmp$interactions%in%keep,]
colnames(tmp)[6]="Gene"
ggplot(tmp, aes(x=Gene,y=Expression,color=interactions))+
geom_jitter(aes(shape = interactions),position = position_jitter(width = .21),size = 2.5)+
theme_bw()
#Aov example for many genes
myAov <- function(df){
aov_list <- aov(expression~interactions, data=df)
aov_out <- as.data.frame(TukeyHSD(aov_list, "interactions")$interactions)
aov_out$groups <- rownames(aov_out)
return(aov_out)
}
tmp2 <- tmp[,-c(1)]
tmp2$Sample <- unname(tmp2$Sample)
tmp2$Age_of_disease_onset <- unname(tmp2$Age_of_disease_onset)
tmp2$PASI <- unname(tmp2$PASI)
tmp2 <- tmp2[,c(4,5,6)]
outDf <- ddply(tmp2, "variable", function(tmp2)  myAov(tmp2))
colnames(outDf)[5] <- "p_adj"
colnames(outDf)[2] <- "Difference"
colnames(outDf)[6] <- "Groups"
View(outDf)
View(tmp2)
outDf <- ddply(tmp2, "Gene", function(tmp2)  myAov(tmp2))
colnames(outDf)[5] <- "p_adj"
colnames(outDf)[2] <- "Difference"
colnames(outDf)[6] <- "Groups"
annotation.h=annotationh[rownames(annotationh)%in%colnames(p)[1:63],colnames(annotationh)%in%c("PASI_(activity_score)","Age_of_disease_onset")]
annotation.h=annotation.h[order(annotation.h[,2]),]
annotation.h[annotation.h[,2]>=40, 2]<-"late"
annotation.h[annotation.h[,2]< 40,2]<-"early"
annotation.t=annotationt[rownames(annotationt)%in%colnames(p)[1:63],colnames(annotationt)%in%c("Age_of_disease_onset", "PASI_(activity_score)")]
annotation.t=annotation.t[order(annotation.t[,2]),]
annotation.t[annotation.t[,2]>=40, 2]<-"late"
annotation.t[annotation.t[,2]<40, 2]<-"early"
annotation.h[,1]=str_replace(annotation.h[,1],",",".")
annotation.h=data.frame(annotation.h)
annotation.h[,1]=as.numeric(as.vector(annotation.h[,1]))
annotation.h[,1]=cut(annotation.h[,1], c(0, 10, 20, Inf))
annotation.h=annotation.h[order(annotation.h[,1]),]
annotation.t[,1]=str_replace(annotation.t[,1],",",".")
annotation.t=data.frame(annotation.t)
annotation.t[,1]=as.numeric(as.vector(annotation.t[,1]))
annotation.t[,1]=cut(annotation.t[,1], c(0, 10, 20, Inf))
annotation.t=annotation.t[order(annotation.t[,1]),]
annotation.pso.h.t=rbind(annotation.h, annotation.t)
Sample=rownames(annotation.pso.h.t)
Sample=str_replace(Sample,"0.*","")
annotation.pso.h.t=cbind(Sample,annotation.pso.h.t)
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"10,20","10_20")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"0,10","0_10")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"20,Inf","20_Inf")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\(","")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\]","")
colnames(annotation.pso.h.t)[2]="PASI"
annotation.pso.h.t=as.data.frame(annotation.pso.h.t)
annotation.pso.h.t[,1]=as.character(annotation.pso.h.t[,1])
annotation.pso.h.t[,2]=as.character(annotation.pso.h.t[,2])
annotation.pso.h.t[,3]=as.character(annotation.pso.h.t[,3])
annotation.pso.h.t=cbind(annotation.pso.h.t, interaction(annotation.pso.h.t$Sample, annotation.pso.h.t$Age_of_disease_onset, annotation.pso.h.t$PASI))
colnames(annotation.pso.h.t)[4]="interactions"
ann=cbind(annotation.pso.h.t, rownames(annotation.pso.h.t))
colnames(ann)[5]="sample"
keep=c("PL.early.20_Inf","PNL.early.20_Inf","PL.late.20_Inf","PNL.late.20_Inf")
ann_filt=ann[ann$interactions%in%keep,]
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
ann=ann_filt
#Merge annotation with the data andsubset differentially expressed genes
dt.merged=merge(ann,dt,by="sample",all=T)
dt.merged.melt=melt(dt.merged)
colnames(dt.merged.melt)[7]="Expression"
tmp <- subset(dt.merged.melt,variable%in%selected_genes_log_all)
tmp=tmp[tmp$interactions%in%keep,]
colnames(tmp)[6]="Gene"
ggplot(tmp, aes(x=Gene,y=Expression,color=interactions))+
geom_jitter(aes(shape = interactions),position = position_jitter(width = .21),size = 2.5)+
theme_bw()
#Aov example for many genes
myAov <- function(df){
aov_list <- aov(expression~interactions, data=df)
aov_out <- as.data.frame(TukeyHSD(aov_list, "interactions")$interactions)
aov_out$groups <- rownames(aov_out)
return(aov_out)
}
tmp2 <- tmp[,-c(1)]
tmp2$Sample <- unname(tmp2$Sample)
tmp2$Age_of_disease_onset <- unname(tmp2$Age_of_disease_onset)
tmp2$PASI <- unname(tmp2$PASI)
tmp2 <- tmp2[,c(4,5,6)]
outDf <- ddply(tmp2, "Gene", function(tmp2)  myAov(tmp2))
annotation.h=annotationh[rownames(annotationh)%in%colnames(p)[1:63],colnames(annotationh)%in%c("PASI_(activity_score)","Age_of_disease_onset")]
annotation.h=annotation.h[order(annotation.h[,2]),]
annotation.h[annotation.h[,2]>=40, 2]<-"late"
annotation.h[annotation.h[,2]< 40,2]<-"early"
annotation.t=annotationt[rownames(annotationt)%in%colnames(p)[1:63],colnames(annotationt)%in%c("Age_of_disease_onset", "PASI_(activity_score)")]
annotation.t=annotation.t[order(annotation.t[,2]),]
annotation.t[annotation.t[,2]>=40, 2]<-"late"
annotation.t[annotation.t[,2]<40, 2]<-"early"
annotation.h[,1]=str_replace(annotation.h[,1],",",".")
annotation.h=data.frame(annotation.h)
annotation.h[,1]=as.numeric(as.vector(annotation.h[,1]))
annotation.h[,1]=cut(annotation.h[,1], c(0, 10, 20, Inf))
annotation.h=annotation.h[order(annotation.h[,1]),]
annotation.t[,1]=str_replace(annotation.t[,1],",",".")
annotation.t=data.frame(annotation.t)
annotation.t[,1]=as.numeric(as.vector(annotation.t[,1]))
annotation.t[,1]=cut(annotation.t[,1], c(0, 10, 20, Inf))
annotation.t=annotation.t[order(annotation.t[,1]),]
annotation.pso.h.t=rbind(annotation.h, annotation.t)
Sample=rownames(annotation.pso.h.t)
Sample=str_replace(Sample,"0.*","")
annotation.pso.h.t=cbind(Sample,annotation.pso.h.t)
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"10,20","10_20")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"0,10","0_10")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"20,Inf","20_Inf")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\(","")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\]","")
colnames(annotation.pso.h.t)[2]="PASI"
annotation.pso.h.t=as.data.frame(annotation.pso.h.t)
annotation.pso.h.t[,1]=as.character(annotation.pso.h.t[,1])
annotation.pso.h.t[,2]=as.character(annotation.pso.h.t[,2])
annotation.pso.h.t[,3]=as.character(annotation.pso.h.t[,3])
annotation.pso.h.t=cbind(annotation.pso.h.t, interaction(annotation.pso.h.t$Sample, annotation.pso.h.t$Age_of_disease_onset, annotation.pso.h.t$PASI))
colnames(annotation.pso.h.t)[4]="interactions"
ann=cbind(annotation.pso.h.t, rownames(annotation.pso.h.t))
colnames(ann)[5]="sample"
keep=c("PL.early.20_Inf","PNL.early.20_Inf","PL.late.20_Inf","PNL.late.20_Inf")
ann_filt=ann[ann$interactions%in%keep,]
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
ann=ann_filt
#Merge annotation with the data andsubset differentially expressed genes
dt.merged=merge(ann,dt,by="sample",all=T)
dt.merged.melt=melt(dt.merged)
colnames(dt.merged.melt)[7]="Expression"
tmp <- subset(dt.merged.melt,variable%in%selected_genes_log_all)
tmp=tmp[tmp$interactions%in%keep,]
colnames(tmp)[6]="Gene"
myAov <- function(df){
aov_list <- aov(expression~interactions, data=df)
aov_out <- as.data.frame(TukeyHSD(aov_list, "interactions")$interactions)
aov_out$groups <- rownames(aov_out)
return(aov_out)
}
tmp2 <- tmp[,-c(1)]
tmp2$Sample <- unname(tmp2$Sample)
tmp2$Age_of_disease_onset <- unname(tmp2$Age_of_disease_onset)
tmp2$PASI <- unname(tmp2$PASI)
tmp2 <- tmp2[,c(4,5,6)]
View(tmp2)
annotation.h=annotationh[rownames(annotationh)%in%colnames(p)[1:63],colnames(annotationh)%in%c("PASI_(activity_score)","Age_of_disease_onset")]
annotation.h=annotation.h[order(annotation.h[,2]),]
annotation.h[annotation.h[,2]>=40, 2]<-"late"
annotation.h[annotation.h[,2]< 40,2]<-"early"
annotation.t=annotationt[rownames(annotationt)%in%colnames(p)[1:63],colnames(annotationt)%in%c("Age_of_disease_onset", "PASI_(activity_score)")]
annotation.t=annotation.t[order(annotation.t[,2]),]
annotation.t[annotation.t[,2]>=40, 2]<-"late"
annotation.t[annotation.t[,2]<40, 2]<-"early"
annotation.h[,1]=str_replace(annotation.h[,1],",",".")
annotation.h=data.frame(annotation.h)
annotation.h[,1]=as.numeric(as.vector(annotation.h[,1]))
annotation.h[,1]=cut(annotation.h[,1], c(0, 10, 20, Inf))
annotation.h=annotation.h[order(annotation.h[,1]),]
annotation.t[,1]=str_replace(annotation.t[,1],",",".")
annotation.t=data.frame(annotation.t)
annotation.t[,1]=as.numeric(as.vector(annotation.t[,1]))
annotation.t[,1]=cut(annotation.t[,1], c(0, 10, 20, Inf))
annotation.t=annotation.t[order(annotation.t[,1]),]
annotation.pso.h.t=rbind(annotation.h, annotation.t)
Sample=rownames(annotation.pso.h.t)
Sample=str_replace(Sample,"0.*","")
annotation.pso.h.t=cbind(Sample,annotation.pso.h.t)
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"10,20","10_20")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"0,10","0_10")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"20,Inf","20_Inf")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\(","")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\]","")
colnames(annotation.pso.h.t)[2]="PASI"
annotation.pso.h.t=as.data.frame(annotation.pso.h.t)
annotation.pso.h.t[,1]=as.character(annotation.pso.h.t[,1])
annotation.pso.h.t[,2]=as.character(annotation.pso.h.t[,2])
annotation.pso.h.t[,3]=as.character(annotation.pso.h.t[,3])
annotation.pso.h.t=cbind(annotation.pso.h.t, interaction(annotation.pso.h.t$Sample, annotation.pso.h.t$Age_of_disease_onset, annotation.pso.h.t$PASI))
colnames(annotation.pso.h.t)[4]="interactions"
ann=cbind(annotation.pso.h.t, rownames(annotation.pso.h.t))
colnames(ann)[5]="sample"
keep=c("PL.early.20_Inf","PNL.early.20_Inf","PL.late.20_Inf","PNL.late.20_Inf")
ann_filt=ann[ann$interactions%in%keep,]
ann=ann_filt
dt.merged=merge(ann,dt,by="sample",all=T)
dt.merged.melt=melt(dt.merged)
colnames(dt.merged.melt)[7]="Expression"
tmp <- subset(dt.merged.melt,variable%in%selected_genes_log_all)
tmp=tmp[tmp$interactions%in%keep,]
View(tmp)
aov_list <- aov(expression~interactions, data=df)
aov_out <- as.data.frame(TukeyHSD(aov_list, "interactions")$interactions)
aov_out$groups <- rownames(aov_out)
return(aov_out)
}
myAov <- function(df){
aov_list <- aov(expression~interactions, data=df)
aov_out <- as.data.frame(TukeyHSD(aov_list, "interactions")$interactions)
aov_out$groups <- rownames(aov_out)
return(aov_out)
}
tmp2 <- tmp[,-c(1)]
tmp2$Sample <- unname(tmp2$Sample)
tmp2$Age_of_disease_onset <- unname(tmp2$Age_of_disease_onset)
tmp2$PASI <- unname(tmp2$PASI)
tmp2 <- tmp2[,c(4,5,6)]
outDf <- ddply(tmp2, "variable", function(tmp2)  myAov(tmp2))
View(tmp2)
tmp2=as.matrix(tmp2)
str(tmp2)
annotation.h=annotationh[rownames(annotationh)%in%colnames(p)[1:63],colnames(annotationh)%in%c("PASI_(activity_score)","Age_of_disease_onset")]
annotation.h=annotation.h[order(annotation.h[,2]),]
annotation.h[annotation.h[,2]>=40, 2]<-"late"
annotation.h[annotation.h[,2]< 40,2]<-"early"
annotation.t=annotationt[rownames(annotationt)%in%colnames(p)[1:63],colnames(annotationt)%in%c("Age_of_disease_onset", "PASI_(activity_score)")]
annotation.t=annotation.t[order(annotation.t[,2]),]
annotation.t[annotation.t[,2]>=40, 2]<-"late"
annotation.t[annotation.t[,2]<40, 2]<-"early"
annotation.h[,1]=str_replace(annotation.h[,1],",",".")
annotation.h=data.frame(annotation.h)
annotation.h[,1]=as.numeric(as.vector(annotation.h[,1]))
annotation.h[,1]=cut(annotation.h[,1], c(0, 10, 20, Inf))
annotation.h=annotation.h[order(annotation.h[,1]),]
annotation.t[,1]=str_replace(annotation.t[,1],",",".")
annotation.t=data.frame(annotation.t)
annotation.t[,1]=as.numeric(as.vector(annotation.t[,1]))
annotation.t[,1]=cut(annotation.t[,1], c(0, 10, 20, Inf))
annotation.t=annotation.t[order(annotation.t[,1]),]
annotation.pso.h.t=rbind(annotation.h, annotation.t)
Sample=rownames(annotation.pso.h.t)
Sample=str_replace(Sample,"0.*","")
annotation.pso.h.t=cbind(Sample,annotation.pso.h.t)
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"10,20","10_20")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"0,10","0_10")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"20,Inf","20_Inf")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\(","")
annotation.pso.h.t[,2]=str_replace (annotation.pso.h.t[,2],"\\]","")
colnames(annotation.pso.h.t)[2]="PASI"
annotation.pso.h.t=as.data.frame(annotation.pso.h.t)
annotation.pso.h.t[,1]=as.character(annotation.pso.h.t[,1])
annotation.pso.h.t[,2]=as.character(annotation.pso.h.t[,2])
annotation.pso.h.t[,3]=as.character(annotation.pso.h.t[,3])
annotation.pso.h.t=cbind(annotation.pso.h.t, interaction(annotation.pso.h.t$Sample, annotation.pso.h.t$Age_of_disease_onset, annotation.pso.h.t$PASI))
colnames(annotation.pso.h.t)[4]="interactions"
ann=cbind(annotation.pso.h.t, rownames(annotation.pso.h.t))
colnames(ann)[5]="sample"
keep=c("PL.early.20_Inf","PNL.early.20_Inf","PL.late.20_Inf","PNL.late.20_Inf")
ann_filt=ann[ann$interactions%in%keep,]
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
#ann_filt$interactions=str_replace(ann_filt$interactions,"20_Inf","severe")
ann=ann_filt
#Merge annotation with the data andsubset differentially expressed genes
dt.merged=merge(ann,dt,by="sample",all=T)
dt.merged.melt=melt(dt.merged)
View(dt.merged)
colnames(dt.merged.melt)[7]="Expression"
tmp <- subset(dt.merged.melt,variable%in%selected_genes_log_all)
tmp=tmp[tmp$interactions%in%keep,]
colnames(tmp)[6]="Gene"
ggplot(tmp, aes(x=Gene,y=Expression,color=interactions))+
geom_jitter(aes(shape = interactions),position = position_jitter(width = .21),size = 2.5)+
theme_bw()
myAov <- function(df){
aov_list <- aov(Expression~interactions, data=df)
aov_out <- as.data.frame(TukeyHSD(aov_list, "interactions")$interactions)
aov_out$groups <- rownames(aov_out)
return(aov_out)
}
tmp2 <- tmp[,-c(1)]
tmp2$Sample <- unname(tmp2$Sample)
tmp2$Age_of_disease_onset <- unname(tmp2$Age_of_disease_onset)
tmp2$PASI <- unname(tmp2$PASI)
tmp2 <- tmp2[,c(4,5,6)]
outDf <- ddply(tmp2, "Gene", function(tmp2)  myAov(tmp2))
colnames(outDf)[5] <- "p_adj"
colnames(outDf)[2] <- "Difference"
colnames(outDf)[6] <- "Groups"
View(outDf)
View(outDf)
ps_early.severe_late.severe=outDf[outDf$Groups%in%c("PNL.late.20_Inf-PNL.early.20_Inf","PL.late.20_Inf-PL.early.20_Inf"),]
PL_PNL_early_late_severe=outDf[outDf$Groups%in%c("PNL.late.20_Inf-PNL.early.20_Inf","PL.late.20_Inf-PL.early.20_Inf"),]
PL_PNL_early_late_severe_signif=PL_PNL_early_late_severe[PL_PNL_early_late_severe$p_adj<0.05,]
save(PL_PNL_early_late_severe,PL_PNL_early_late_severe_signif, file = "PL_PNL_early_late_severe_anova.RData")
write.table(PL_PNL_early_late_severe_signif, file="PL_PNL_early_late_severe_signif.txt", quote=F, sep="\t")
ggplot(outDf, aes(x=Difference,y=Groups,color=p_adj))+
geom_point()+
theme_bw()+
facet_wrap(~variable)+
theme(axis.text.x = element_text(colour="black"), axis.text.y = element_text(size=9))+
geom_errorbarh(aes(xmax = upr, xmin = lwr, height = .2))
####
ggplot(outDf, aes(x=Difference,y=Groups,color=p_adj))+
geom_point()+
theme_bw()+
facet_wrap(~Gene)+
theme(axis.text.x = element_text(colour="black"), axis.text.y = element_text(size=9))+
geom_errorbarh(aes(xmax = upr, xmin = lwr, height = .2))
PL_PNL_early_late_severe=outDf[outDf$Groups%in%c("PNL.late.20_Inf-PNL.early.20_Inf","PL.late.20_Inf-PL.early.20_Inf"),]
PL_PNL_early_late_severe_signif=PL_PNL_early_late_severe[PL_PNL_early_late_severe$p_adj<0.05,]
save(PL_PNL_early_late_severe,PL_PNL_early_late_severe_signif, file = "PL_PNL_early_late_severe_anova.RData")
PL_PNL_early_late_severe=outDf[outDf$Groups%in%c("PNL.late.20_Inf-PNL.early.20_Inf","PL.late.20_Inf-PL.early.20_Inf"),]
PL_PNL_early_late_severe_signif=PL_PNL_early_late_severe[PL_PNL_early_late_severe$p_adj<0.05,]
save(PL_PNL_early_late_severe,PL_PNL_early_late_severe_signif, file = "PL_PNL_early_late_severe_anova.RData")
write.table(PL_PNL_early_late_severe_signif, file="PL_PNL_early_late_severe_signif.txt", quote=F, sep="\t")
ggplot(outDf, aes(x=Difference,y=Groups,color=p_adj))+
geom_point()+
theme_bw()+
facet_wrap(~Gene)+
theme(axis.text.x = element_text(colour="black"), axis.text.y = element_text(size=9))+
geom_errorbarh(aes(xmax = upr, xmin = lwr, height = .2))
###########
View(outDf)
outDf$Groups%in%c("PNL.late.20_Inf-PNL.early.20_Inf","PL.late.20_Inf-PL.early.20_Inf")
outDf[outDf$Groups%in%c("PNL.late.20_Inf-PNL.early.20_Inf","PL.late.20_Inf-PL.early.20_Inf"),]
ggplot(PL_PNL_early_late_severe, aes(x=Difference,y=Groups,color=p_adj))+
geom_point()+
theme_bw()+
facet_wrap(~Gene)+
theme(axis.text.x = element_text(colour="black"), axis.text.y = element_text(size=9))+
geom_errorbarh(aes(xmax = upr, xmin = lwr, height = .2))
